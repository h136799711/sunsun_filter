{"version":3,"sources":["common.jsx"],"names":[],"mappings":"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","file":"common.js","sourcesContent":["const { Upload, Button, Icon, message, Spin } = antd;\r\nconst imgUrl = 'http://api.moodwo.com/public/index.php/picture/index?id=';\r\n\r\nconst Pic_upload = React.createClass({\r\n    getInitialState() {\r\n        return {\r\n            fileList: !this.props.default ? [] : [{\r\n                url: imgUrl + this.props.default\r\n            }]\r\n        };\r\n    },\r\n    uploaderChange(info){\r\n        let fileList = info.fileList;\r\n        // 1. 上传列表数量的限制\r\n        //    只显示前5张图片\r\n        fileList = fileList.slice(0,5);\r\n\r\n        // 2. 读取远程路径并显示链接\r\n        fileList = fileList.map((file) => {\r\n            if (file.response) {\r\n                // 组件会将 file.url 作为链接进行展示\r\n                file.url = imgUrl+file.response.id;\r\n            }\r\n            return file;\r\n        });\r\n\r\n        // 3. 按照服务器返回信息筛选成功上传的文件\r\n        fileList = fileList.filter((file) => {\r\n            if (file.response) {\r\n                return parseInt(file.response.status);\r\n            }\r\n            return true;\r\n        });\r\n\r\n        this.setState({ fileList });\r\n        if(this.props.selectOver){\r\n            if(fileList.length!=0){\r\n                let ids = [];\r\n                fileList.forEach(function(val){\r\n                    if(val.response){\r\n                        ids.push(val.response.id);\r\n                    }\r\n                });\r\n                this.props.selectOver(ids);\r\n            }else{\r\n                this.props.selectOver([]);\r\n            }\r\n        }\r\n    },\r\n    render(){\r\n        const props = {\r\n            name: 'image',\r\n            action: getBaseUrl() + '/mengwu/fileupload/index',\r\n            listType: 'picture',\r\n            accept: '.jpe, .jpg, .jpeg, .gif, .png, .bmp',\r\n            defaultFileList: [],\r\n            fileList: this.state.fileList,\r\n            showUploadList: true,\r\n            onPreview: (file) => {\r\n                this.setState({\r\n                    priviewImage: file.url,\r\n                    priviewVisible: true\r\n                });\r\n            },\r\n            onChange: this.uploaderChange\r\n        };\r\n        return(\r\n            <div className=\"oper\">\r\n                <Upload {...props}>\r\n                    <a className=\"btn up-pic\" href=\"javascript:void(0);\">晒照片</a><span className=\"tip\">限5张</span>\r\n                </Upload>\r\n            </div>\r\n        );\r\n    }\r\n});\r\nconst Pingjia = React.createClass({\r\n    getInitialState(){\r\n        let data = items.map(function(val){\r\n            return {pid: val.id,psku_id: val.psku_id,group_id:val.group_id,package_id:val.package_id,imgs:[],comment:'好评!'}\r\n        });\r\n        return({\r\n            list: items,\r\n            data,\r\n            loading: false\r\n        });\r\n    },\r\n    selectOver(index,ids){\r\n        let data = this.state.data;\r\n        data[index].imgs = ids;\r\n        this.setState({data});\r\n    },\r\n    changeComment(index,e){\r\n        let data = this.state.data;\r\n        data[index].comment = e.target.value;\r\n        this.setState({data});\r\n    },\r\n    save(){\r\n        let data = this.state.data;\r\n        for(let i=0; i<data.length; i++){\r\n            if($.trim(data[i].comment)==\"\"){\r\n                let refs = 'comment'+data[i].pid;\r\n                this.refs[refs].focus();\r\n                message.error('有商品没有评价哦，请先完成评价后保存~');\r\n                return;\r\n            }\r\n        }\r\n        let url = getBaseUrl() + '/mengwu/mengwuApi/order_comment';\r\n\r\n        let pids = data.map(val=>val.pid);\r\n        let imgs = data.map(val=>val.imgs.join('-'));\r\n        let group_ids = data.map(val=>val.group_id);\r\n        let package_ids = data.map(val=>val.package_id);\r\n        let psku_ids = data.map(val=>val.psku_id);\r\n\r\n        let formData = {\r\n            pid: pids.join(','),\r\n            order_code: order_code,\r\n            comment: data.map(val=>val.comment),\r\n            attachments: imgs.join(','),\r\n            psku_id: psku_ids.join(','),\r\n            group_id: group_ids.join(','),\r\n            package_id: package_ids.join(',')\r\n\r\n        };\r\n        this.setState({loading:true});\r\n        _post(url,jQuery.param(formData),{data_back: function(data){\r\n            if(data.status){\r\n                this.setState({loading:false});\r\n                window.location.replace(getBaseUrl() + '/mengwu/user/order_pingjia_suc');\r\n            }else{\r\n                this.setState({loading:false});\r\n                if(typeof data.info.redirect !=\"undefined\"){\r\n                    message.error(data.info.info);\r\n                    window.location.href = data.info.redirect;\r\n                }else{\r\n                    message.error(data.info);\r\n                }\r\n            }\r\n        }.bind(this)});\r\n    },\r\n    render(){\r\n        let data = this.state.data;\r\n        const list = this.state.list.map((val,index)=>{\r\n            let comment = _.find(data,['pid',val.id]).comment;\r\n            return(\r\n                <div className=\"item-wrap\">\r\n                    <div className=\"item\">\r\n                        <div className=\"item-pic\"><img src={val.img}/></div>\r\n                        <div className=\"item-name\">{val.name}</div>\r\n                    </div>\r\n                    <div className=\"comment\">\r\n                        <textarea ref={'comment'+index} placeholder=\"亲，写点评价吧，您的评价对其他买家有很大的帮助\" value={comment} onChange={e=>this.changeComment(index,e)} />\r\n                        <Pic_upload selectOver={ids=>this.selectOver(index,ids)}/>\r\n                    </div>\r\n                </div>\r\n            )\r\n        });\r\n        return(\r\n            <Spin spinning={this.state.loading}>\r\n                <div className=\"pingjia-list\" id=\"pingjia\">\r\n                    {list}\r\n                </div>\r\n                <div className=\"save\">\r\n                    <a className=\"btn btn-save\" href=\"javascript:void(0);\" onClick={this.save}>保存评价</a>\r\n                </div>\r\n            </Spin>\r\n        );\r\n    }\r\n});\r\nReactDOM.render(\r\n    <Pingjia />,\r\n    document.getElementById('pingjia')\r\n);"]}